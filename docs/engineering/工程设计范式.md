###  å·¥ç¨‹è®¾è®¡èŒƒå¼

## Rails Style çš„ç‰¹ç‚¹

> é€‚ç”¨äºå•ä¸€åŠŸèƒ½çš„é¡¹ç›®ï¼‰
ç‰¹ç‚¹ï¼šçºµå‘å±‚çš„åˆ’åˆ†ï¼ŒåŒä¸€ç±»æ–‡ä»¶æ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚
ä¼˜åŠ¿ï¼šä¾¿äºåˆå¹¶å¯¼å‡ºï¼Œä¾¿äºè¿›è¡Œå±‚çš„æ‰©å±•ã€‚
ä¸è¶³ï¼šä¾èµ–å…³ç³»éš¾ä»¥ç›´è§‚çš„åˆ†æï¼Œå¯¹åŠŸèƒ½çš„ä¿®æ”¹ä¼šæ¶‰åŠåˆ°å¤§é‡çš„ç›®å½•åˆ‡æ¢ï¼Œéš¾ä»¥æ°´å¹³æ‹†åˆ†ã€‚

```js
// Rails Style TodoList
root
|â”€â”€ reducers              
|   â”œâ”€â”€ todoReducer.js
|   â””â”€â”€ fileterReducer.js
â”œâ”€â”€ actions                 
|   â”œâ”€â”€ todoActions.js                         
|   â””â”€â”€ filterAction.js
â”œâ”€â”€ components                 
|   â”œâ”€â”€ todoList.jsx
|   â”œâ”€â”€ todoItem.jsx               
|   â””â”€â”€ filter.jsx
â”œâ”€â”€ containers                 
|   â”œâ”€â”€ todoListContainer.jsx
|   â”œâ”€â”€ todoItemContainer.jsx               
|   â””â”€â”€ filterContainer.jsx
â”œâ”€â”€ App.jsx
â””â”€â”€ index.js
```

##  Domain Styleï¼ˆé€‚ç”¨äºèšåˆåŠŸèƒ½å‹é¡¹ç›®ï¼‰
ç‰¹ç‚¹ï¼šæ¨ªå‘åŠŸèƒ½çš„åˆ’åˆ†ï¼ŒåŒä¸€featureæ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚
ä¼˜åŠ¿ï¼šä¾¿äºæ°´å¹³æ‹†åˆ†ï¼Œä¾¿äºè¿›è¡ŒåŠŸèƒ½çš„æ‰©å±•ã€‚
ä¸è¶³ï¼šä¼šäº§ç”Ÿå¤§é‡é‡å¤ç»“æ„ï¼Œéš¾ä»¥å‚ç›´æ‹†åˆ†
```js
// Aant Design
â”œâ”€â”€ ...                            
â”œâ”€â”€ components                
|   â”œâ”€â”€ util 
        â””â”€â”€ ...    
|   â”œâ”€â”€ alert             
|   |   â”œâ”€â”€ demo         
|   |   â”œâ”€â”€ index.en-US.msd    
|   |   â”œâ”€â”€ index.tsx
|   |   â”œâ”€â”€ index.zh-CN.md
|   |   â””â”€â”€ style
|   â”œâ”€â”€ anchor             
|   |   â”œâ”€â”€ Anchor.tsx
|   |   â”œâ”€â”€ AnchorLink.tsx
|   |   â”œâ”€â”€ __tests__
|   |   â”œâ”€â”€ demo
|   |   â”œâ”€â”€ index.en-US.msd    
|   |   â”œâ”€â”€ index.tsx
|   |   â”œâ”€â”€ index.zh-CN.md
|   |   â””â”€â”€ style
â””â”€â”€ ... 
```

## å¦‚ä½•é€‰æ‹©é€‚åˆçš„å·¥ç¨‹èŒƒå¼

### å•ä¸€åŠŸèƒ½çš„é¡¹ç›®
åº“ã€ä¸‰æ–¹åŒ…ï¼šfs-extraã€axiosç­‰
ç”±äºä¸å­˜åœ¨æ°´å¹³æ‹†åˆ†çš„å¿…è¦æ€§ã€æ•…å¯ä»¥é€‰æ‹©Rails Style
æ˜“äºæ‰©å±•
å‡å°‘é‡å¤ä»£ç 
```js
// Axios
root
|â”€â”€ dist              
|   â””â”€â”€ ...
â”œâ”€â”€ examples                                     
|   â””â”€â”€ ...
â”œâ”€â”€ lib                 
|   â”œâ”€â”€ adapters
|   |    â””â”€â”€ ...
|   â”œâ”€â”€ cancel
|   |    â””â”€â”€ ...
|   â”œâ”€â”€ core
|   |     â””â”€â”€ ...   
|   â”œâ”€â”€ defaults.js       
|   â””â”€â”€ axios.js
â”œâ”€â”€ sandbox                                     
|   â””â”€â”€ ...
â”œâ”€â”€ test                                    
|   â””â”€â”€ ...
â”œâ”€â”€ package.json
â””â”€â”€ webpack.config.js
```

### èšåˆåŠŸèƒ½å‹é¡¹ç›®

ç»„ä»¶æ± ã€utilsï¼šant-designã€element-uiã€lodashç­‰
çºµå‘åˆ†å±‚å°‘ï¼Œææ˜“æ¨ªå‘æ‰©å±•-æ•…é€‰æ‹©Domain Style
æ˜“äºæ·»åŠ æ–°feature
ä¾¿äºæ¨ªå‘æ‹†åˆ†
ä¸šåŠ¡å·¥ç¨‹é¡¹ç›®

### å³æœ‰å¤§é‡çš„å‚ç›´åˆ†å±‚ï¼Œåˆæœ‰å¤§é‡çš„featureèšåˆ
Rails Style + Domain Style

## ğŸ… Rails Style å¯¹æ¯” Domain Style

- Rails Style	  
    - çºµå‘â€œå±‚â€çš„åˆ’åˆ†ï¼ŒåŒä¸€ç±»æ–‡ä»¶æ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹	
    - ä¾¿äºåˆå¹¶å¯¼å‡ºï¼Œä¾¿äºè¿›è¡Œâ€œå±‚â€çš„æ‰©å±•	
    - ä¾èµ–å…³ç³»éš¾ä»¥ç›´è§‚åœ°åˆ†æï¼Œå¯¹åŠŸèƒ½çš„ä¿®æ”¹ä¼šæ¶‰åŠåˆ°å¤§é‡çš„ç›®å½•åˆ‡æ¢ ï¼Œéš¾ä»¥æ°´å¹³æ‹†åˆ†	
    - å•ä¸€åŠŸèƒ½çš„é¡¹ç›®
- Domain Style  
    - æ¨ªå‘â€œåŠŸèƒ½â€çš„åˆ’åˆ†ï¼ŒåŒä¸€featureæ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹	
    - ä¾¿äºæ°´å¹³æ‹†åˆ†ï¼Œä¾¿äºè¿›è¡Œâ€œåŠŸèƒ½â€çš„æ‰©å±•	
    - ä¼šäº§ç”Ÿå¤§é‡çš„é‡å¤ç»“æ„ï¼Œéš¾ä»¥å‚ç›´æ‹†åˆ†	
    - èšåˆåŠŸèƒ½å‹é¡¹ç›®
ä¸šåŠ¡å·¥ç¨‹é¡¹ç›®ä¸€èˆ¬éœ€è¦Rails Style å’Œ Domain Styleç»“åˆ

## multi-repo VS mono-repo

å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ä¸¤ç§ä»£ç é£æ ¼ä»“åº“çš„ç®¡ç†é£æ ¼

- multi-repoï¼šæŠŠæ¯ä¸ªé¡¹ç›®éƒ½åˆ†åˆ«ç”¨gitæ‰˜ç®¡
- mono-repoï¼šç»Ÿä¸€ç”¨ä¸€ä¸ªgitä»“åº“ç®¡ç†æ‰€æœ‰çš„é¡¹ç›®

### multi-repo
```js
// multi-repo
root
|â”€â”€ project-a          
|   â”œâ”€â”€ ...
|   â””â”€â”€ .git
â”œâ”€â”€ project-b                 
|   â”œâ”€â”€ ...                    
|   â””â”€â”€ git
â”œâ”€â”€ project-c                 
|   â”œâ”€â”€ ...  
|   â””â”€â”€ .git
â”œâ”€â”€ project-d                 
|   â”œâ”€â”€ ...    
|   â””â”€â”€ .git
...
```

ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºå¤šä¸ªé¡¹ç›®å¯¹åº”å¤šä¸ªä»“åº“ï¼Œå¤§å¤šæ•°å·¥ç¨‹ï¼Œå…¶å®éƒ½æ˜¯ä»¥multi-repoæ–¹å¼ç®¡ç†çš„

ä¼˜åŠ¿ï¼š

å¯ä»¥è®©å„é¡¹ç›®å›¢é˜Ÿæ ¹æ®éœ€è¦å®šåˆ¶æ›´é€‚åˆè‡ªå·±çš„workflow

ä¸è¶³ï¼š

éš¾ä»¥å¯¹æ‰€æœ‰é¡¹ç›®ç»Ÿä¸€è¿›è¡Œæ“ä½œï¼ˆgit checkout / npm publish / npm run buildï¼‰
éš¾ä»¥è¿½è¸ªä¾èµ–å…³ç³»ï¼ˆa->b->cï¼‰


### mono-repo
```js
// multi-repo

â”œâ”€â”€ .git 
â”œâ”€â”€ lerna.json
â”œâ”€â”€ package.json                                        
â”œâ”€â”€ packages                 
    â”œâ”€â”€ project-a
    |    â”œâ”€â”€ README.md
    |    â”œâ”€â”€ __tests__
    |    â”œâ”€â”€ lib
    |    â””â”€â”€ package.json
    â”œâ”€â”€ project-b
    |    â”œâ”€â”€ README.md
    |    â”œâ”€â”€ __tests__
    |    â”œâ”€â”€ lib
    |    â””â”€â”€ package.json
    â”œâ”€â”€ project-c
        â”œâ”€â”€ README.md
        â”œâ”€â”€ __tests__
        â”œâ”€â”€ lib
        â””â”€â”€ package.json
```

å¹¿æ³›åº”ç”¨äºä¸€äº›çŸ¥åå¼€æºé¡¹ç›®å’Œç¡…è°·å·¨å¤´ï¼ˆReact/Angular/Vuetify/Googleï¼‰
ä¼˜åŠ¿
 - æ–¹ä¾¿ç»Ÿä¸€åœ°æ“ä½œå„ä¸ªé¡¹ç›®ï¼ˆgit checkout / npm publish / npm run buildï¼‰
 - åˆ©ç”¨å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿½è¸ªé¡¹ç›®é—´çš„ä¾èµ–å…³ç³»
ä¸è¶³ï¼š

 - ä»£ç åº“éšç€ä¸šåŠ¡å‘å±•ä¼šéå¸¸å·¨å¤§
 - å¤±å»éƒ¨åˆ†çš„çµæ´»æ€§ï¼ˆworkflowå¿…é¡»ç»Ÿä¸€ï¼‰
 - å¼ºä¾èµ–äºmono-repoçš„ç®¡ç†å·¥å…·

 ### multi-repoçš„ç®¡ç†

- git submodule
```js
    # åˆå§‹åŒ–git submodulesä»“åº“
    git submodule init
    # æ·»åŠ ä¸€ä¸ªsubmodule
    git submodule add https://github.com
    # æ›´æ–°æ‰€æœ‰çš„submodule
    git submodule update
    # æŸ¥submodule status
    git  submodule status
    # foreach ç”¨äºåœ¨æ¯ä¸ªsubmoduleä¸­æ‰§è¡Œå‘½ä»¤
    git submodule foreach "git checkout -b featureA"
```
- itæä¾›çš„ä¸€ç§ç®¡ç†å­ä»“åº“çš„æ–¹æ¡ˆ
- å¯ä»¥æ‰¹é‡ç®¡ç†å¤šä¸ªgit repo
- æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçˆ¶repoç»´æŠ¤äº†ä¸€ä»½å„ä¸ªå­repoçš„æ¸…å•
- å‘è¿˜æ˜¯ä¸å°‘çš„ï¼šgit Submoduleçš„å‘
- æ›¿ä»£æ–¹æ¡ˆï¼šgit subtree

mono-repoçš„ç®¡ç†-lerna
- ä¸ºjsç”Ÿæ€ä¸‹çš„mono-repoç®¡ç†æä¾›ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆ
0 babel/create-react-app/jest/react-router/umi/nestjs
### è§£å†³æ–¹æ¡ˆï¼š
mono-repoä¸‹çš„ä¾èµ–ç®¡ç†ã€ç‰ˆæœ¬ç®¡ç†ã€å¼€å‘ææ•ˆã€å·¥ä½œæµ

#### ç›®å½•ç»“æ„
- æ•´ä½“ä½œä¸ºä¸€ä¸ªGitä»“åº“ï¼Œä¹Ÿæ˜¯ä¸ªnpmåŒ…ï¼ˆç§æœ‰ï¼‰
- lerna.jsonæ˜¯æ•´ä¸ªmmono-repoçš„é…ç½®æ–‡ä»¶
- æ¯ä¸ªçœŸæ­£çš„é¡¹ç›®ï¼Œå¹³é“ºåœ¨packages/ä¸­
- æ•´ä¸ªé¡¹ç›®å¯ä»¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¾èµ–ï¼ˆä¹Ÿå¯ä»¥åˆ†åˆ«ç®¡ç†ï¼‰
```js
// lerna
â”œâ”€â”€ .git 
â”œâ”€â”€ lerna.json
â”œâ”€â”€ package.json                                        
â”œâ”€â”€ packages                 
    â”œâ”€â”€ project-a
    |    â”œâ”€â”€ README.md
    |    â”œâ”€â”€ __tests__
    |    â”œâ”€â”€ lib
    |    â””â”€â”€ package.json
    â”œâ”€â”€ project-b
    |    â”œâ”€â”€ README.md
    |    â”œâ”€â”€ __tests__
    |    â”œâ”€â”€ lib
    |    â””â”€â”€ package.json
    â”œâ”€â”€ project-c
        â”œâ”€â”€ README.md
        â”œâ”€â”€ __tests__
        â”œâ”€â”€ lib
        â””â”€â”€ package.json
```

## ç”¨lernaç®¡ç†é¡¹ç›®å®æˆ˜ é‡è¦
ç”¨lernaç®¡ç†é¡¹ç›®å®æˆ˜
```js
npm i lerna -g
lerna init
```
1. åˆå§‹åŒ–çš„ç›®å½•ç»“æ„
- packages
  - lerna.json
  - package.json


```js
###  åˆ›å»ºé¡¹ç›®1
lerna create pac-1
###  åˆ›å»ºé¡¹ç›®3
lerna create pac-2
###  åˆ›å»ºé¡¹ç›®3
lerna create pac-3
```
ç›®å½•ä¸­ lerna.jsoon
```js
{
  // é…ç½®$schemaå¯ä»¥åœ¨vscodeä¸­ï¼Œé¼ æ ‡æ»‘å€’æ¯ä¸ªé…ç½®é¡¹æ—¶å€™ï¼Œå¯ä»¥çœ‹æ¯ä¸ªé…ç½®é¡¹çš„ä»‹ç» 
  // å¯ä»¥åœ¨https://www.schemastore.org/json/ä¸­ç½‘ç«™æŸ¥çœ‹çŸ¥åé¡¹ç›®çš„æè¿°æ–‡ä»¶
  "$schema": "http://json.schemastore.org/lerna",
  "packages": [
    "packages/*"
  ],
  "version": "independent" // å¯ä»¥ç»™å„ä¸ªé¡¹ç›®å‘ä¸åŒçš„ç‰ˆæœ¬
}
```
> æ¥ä¸‹æ¥æˆ‘ä»¬ä¸ºpac-1ã€ pac-2ã€pac-3æ·»åŠ ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬åˆ¶é€ è¿™æ ·ä¸€ç§ä¾èµ–ï¼Œpac-1æ¨¡å—è¢«pac-2ä¾èµ–ï¼›pac-2æ¨¡å—è¢«pac-3æ¨¡å—ä¾èµ–ï¼Œ è¿™æ—¶å€™å°±å½¢æˆäº†pac-1ã€ pac-2ã€pac-3é—´æ¥ä¾èµ–å…³ç³»ã€‚

2. æ·»åŠ é¡¹ç›®ä¾èµ–
```js
# åˆ¶é€ ä¾èµ–å…³ç³»ï¼Œå¯¹äºå†…éƒ¨é¡¹ç›®çš„ä¾èµ–ï¼Œlernaä¼šä»¥è½¯è¿æ¥çš„å½¢å¼ï¼Œç»™å®ƒä»¬ç›¸äº’è½¯é“¾æ¥èµ·æ¥
lerna add pac-1 packages/pac-2
lerna add pac-2 packages/pac-3
```
å¦‚æœæˆ‘ä»¬ç»™é¡¹ç›®æ·»åŠ å¤–éƒ¨ä¾èµ–ï¼Œå¯èƒ½éœ€è¦ç»™æ¯ä¸ªé¡¹ç›®node_moudleséƒ½æ·»åŠ ï¼ŒåŒä¸€ä¸ªä¾èµ–ä¼šå®‰è£…å¾ˆå¤šæ¬¡ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œleranå¯ä»¥æŠŠä¾èµ–æ·»åŠ åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼›lerna cleanå»æ¸…é™¤æ¯ä¸ªé¡¹ç›®ä¸­node_modulesç›¸åŒçš„ä¾èµ–;ç”¨ lerna bootstrap --hoisté‡æ–°å®‰è£…ä¾èµ–ï¼Œ

3. å‘ç‰ˆ
éœ€è¦æ³¨æ„æ˜¯çš„ lerna.json é…ç½®ä¸º"version": "independent"æ—¶å¯ä»¥ä¸ºæ¯ä¸ªåŒ…ç‹¬ç«‹å‘ä¸åŒçš„ç‰ˆæœ¬ï¼Œå¦‚æœ"version":'0.0.0'æ˜¯å‘åŒæ ·çš„ç‰ˆæœ¬
```js
leran publish
```
4. å…¶å®ƒ
å¯ä»¥ç”¨lerna -hæŸ¥çœ‹å…¨éƒ¨æŒ‡ä»¤
```
lerna  exec [cmd] [args...] # æ‰§è¡Œæ¯ä¸€ä¸ªpackage.jsonä½ æƒ³æŒ‡è¡Œçš„å‘½ä»¤
lerna run <script> # æ‰§è¡Œpackage.josn ä¸­scripté…ç½®çš„å‘½ä»¤
lerna diff [pkgName] # å¯¹æ¯” æ–‡ä»¶å˜åŒ–
lerna changed # æŸ¥çœ‹æ–‡ä»¶å˜åŒ–
```
#### lerna.json é…ç½®
```js
{
  "version":"0.0.0",
  "npmClient":"npm",
  "npmClientArgs":[
    "--pure-lockfile"
  ],
  "command": {
    "publish": {
      "ignoreChanges": ["ignored-file","*.md"],
      "message": "chore(replease):publish",
      "registry": "https://npm.pkg.github.com"
    },
    "bootstrap": {
      "ignore": "component-*",
      "npmClientArgs": ["--no-package-lock"]
    }
  },
  "packages": ["packages/*"]
}
```
å…¶å®åªæœ‰å‡ ä¸ªä¸»è¦å­—æ®µï¼šversionã€npm*ã€commandã€packages

commandé…ç½®-json schemaæŸ¥çœ‹

é…ç½®lernaå­å‘½ä»¤çš„é»˜è®¤é¡¹ç›®
version: å†³å®šfixed mode / independent mode

packagesï¼šé¡¹ç›®è·¯å¾„

npm*ï¼šè§£è€¦åŒ…ç®¡ç†å·¥å…·

### ä¸€äº›æ³¨æ„é¡¹
mono-repo ä¸å¯åµŒå¥—
mono-repo çš„ä¸»ä»“åº“å¿…é¡»æ˜¯ç§æœ‰çš„ï¼ˆprivateï¼štrueï¼‰
å¦‚æœä½ å¯¹ä»“åº“çš„ç§å¯†æ€§è¦æ±‚éå¸¸é«˜ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨npmè€Œä½¿ç”¨gitåº”ç”¨ä¾èµ–
ä»»ä½•çš„jsoné…ç½®è®°ä¸ä½ï¼Œéƒ½å¯ä»¥ç”¨json schema